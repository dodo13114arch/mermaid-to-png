<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="David Chang">
    <meta name="description" content="Mermaid Simple - å€‹äººç‰ˆåœ–è¡¨æ¸²æŸ“å·¥å…·">
    <title>Mermaid Simple - å€‹äººç‰ˆ</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #333;
            --panel-bg: white;
            --panel-shadow: rgba(0,0,0,0.1);
            --border-color: #ddd;
            --primary-color:rgb(212, 106, 57);
            --primary-text: white;
            --success-color:rgb(250, 177, 20);
        }

        .dark-mode {
            --bg-color: #212529;
            --text-color: #e9ecef;
            --panel-bg: #343a40;
            --panel-shadow: rgba(255,255,255,0.1);
            --border-color: #495057;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', Arial, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background 0.3s, color 0.3s;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--panel-bg);
            border-radius: 8px;
            box-shadow: 0 2px 10px var(--panel-shadow);
        }
        
        .header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 2.2em;
        }
        
        .header .subtitle {
            color: var(--text-color);
            opacity: 0.8;
            font-size: 1.1em;
        }
        
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--primary-color);
            color: var(--primary-text);
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .theme-toggle:hover {
            transform: scale(1.1);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: var(--panel-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px var(--panel-shadow);
        }
        
        .panel h2 {
            margin-bottom: 15px;
            color: var(--text-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
        }
        
        #code-input {
            width: 100%;
            height: 400px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
            border-radius: 4px;
            padding: 10px;
            resize: vertical;
        }
        
        .controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            background: var(--primary-color);
            color: var(--primary-text);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: var(--border-color);
            color: var(--text-color);
        }
        
        select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--panel-bg);
            color: var(--text-color);
            font-size: 14px;
        }
        
        .examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }
        
        .example-btn {
            background: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .example-btn:hover {
            background: var(--primary-color);
            color: var(--primary-text);
        }
        
        .preview-area {
            min-height: 300px;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            background: var(--bg-color);
        }
        
        .preview-svg {
            max-width: 100%;
            max-height: 100%;
            cursor: grab;
            transform-origin: center;
            transition: transform 0.1s ease;
        }
        
        .preview-svg:active {
            cursor: grabbing;
        }
        
        .zoom-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }
        
        .zoom-btn {
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            padding: 5px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .placeholder {
            color: var(--text-color);
            opacity: 0.5;
            text-align: center;
            font-size: 18px;
        }
        
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
            min-height: 20px;
        }
        
        .status.success {
            background: var(--success-color);
            color: white;
        }
        
        .status.error {
            background: #dc3545;
            color: white;
        }
        
        .status.info {
            background: #17a2b8;
            color: white;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .history-section {
            display: none;
            background: var(--panel-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px var(--panel-shadow);
        }
        
        .history-item {
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .history-item:hover {
            border-color: var(--primary-color);
            transform: translateY(-1px);
        }
        
        .history-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 12px;
            opacity: 0.8;
        }
        
        .history-theme {
            background: var(--primary-color);
            color: var(--primary-text);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
        }
        
        .history-code {
            background: var(--bg-color);
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .history-code-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--primary-color);
        }
        
        .pagination {
            margin-top: 20px;
            text-align: center;
        }
        
        .page-btn {
            background: var(--panel-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            margin: 0 2px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .page-btn:hover, .page-btn.active {
            background: var(--primary-color);
            color: var(--primary-text);
            border-color: var(--primary-color);
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .examples {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
        
        <div class="header">
            <h1>ğŸ¨ Mermaid Simple</h1>
            <p class="subtitle">å€‹äººç‰ˆ - ç°¡å–®æ˜“ç”¨çš„ Mermaid åœ–è¡¨æ¸²æŸ“å·¥å…·</p>
        </div>
        
        <div class="main-content">
            <div class="panel">
                <h2>ğŸ“ ç·¨è¼¯å€</h2>
                <textarea id="code-input" placeholder="è«‹è¼¸å…¥ Mermaid ä»£ç¢¼..."></textarea>
                
                <div class="controls">
                    <button class="btn" onclick="renderDiagram()">ğŸ¨ æ¸²æŸ“åœ–è¡¨</button>
                    <button class="btn btn-secondary" onclick="downloadResult()">ğŸ’¾ ä¸‹è¼‰</button>
                    <select id="format-select">
                        <option value="svg">SVG</option>
                        <option value="png">PNG</option>
                    </select>
                    <select id="theme-select" onchange="setTheme(this.value)">
                        <option value="light">æ·ºè‰²ä¸»é¡Œ</option>
                        <option value="dark">æ·±è‰²ä¸»é¡Œ</option>
                    </select>
                    <select id="quality-select" style="display:none;">
                        <option value="web">ç¶²é å“è³ª</option>
                        <option value="a4">A4 å°åˆ·</option>
                        <option value="a2">A2 æµ·å ±</option>
                    </select>
                </div>
                
                <div class="examples">
                    <button class="example-btn" onclick="loadExample('flowchart')">æµç¨‹åœ–</button>
                    <button class="example-btn" onclick="loadExample('sequence')">åºåˆ—åœ–</button>
                    <button class="example-btn" onclick="loadExample('gantt')">ç”˜ç‰¹åœ–</button>
                    <button class="example-btn" onclick="loadExample('class')">é¡åˆ¥åœ–</button>
                    <button class="example-btn" onclick="loadExample('pie')">åœ“é¤…åœ–</button>
                    <button class="example-btn" onclick="loadExample('git')">Git åœ–</button>
                </div>
                
                <button class="btn btn-secondary" onclick="loadHistory()" style="margin-top: 15px;">ğŸ“œ æŸ¥çœ‹æ­·å²</button>
            </div>
            
            <div class="panel">
                <h2>ğŸ‘ï¸ é è¦½å€</h2>
                <div class="preview-area" id="preview-area">
                    <div class="placeholder">è«‹å…ˆæ¸²æŸ“åœ–è¡¨</div>
                    <div class="zoom-controls" style="display:none;">
                        <button class="zoom-btn" onclick="zoomSVG(1.2)">+</button>
                        <button class="zoom-btn">100%</button>
                        <button class="zoom-btn" onclick="zoomSVG(0.8)">-</button>
                        <button class="zoom-btn" onclick="resetZoom()">é‡ç½®</button>
                    </div>
                </div>
                <div class="status" id="status"></div>
            </div>
        </div>
        
        <div class="history-section" id="history-section">
            <h2>ğŸ“œ ä»Šæ—¥æ­·å²è¨˜éŒ„</h2>
            <div id="history-list"></div>
            <div class="pagination" id="history-pagination"></div>
        </div>
    </div>
    
    <footer style="text-align: center; padding: 20px; margin-top: 40px; color: var(--text-color); opacity: 0.6; font-size: 12px;">
        Â© 2025 David Chang - Mermaid Simple
    </footer>
    
    <script>
        let currentTheme = 'light';
        let currentZoom = 1;
        let svgPosition = { x: 0, y: 0 };
        let isDragging = false;
        let dragStart = { x: 0, y: 0 };
        let currentPage = 1;
        const itemsPerPage = 10;
        let lastRenderData = null;
        
        // API åŸºç¤ URL
        const API_BASE = '';
        
        const examples = {
            flowchart: `graph TD
    A[é–‹å§‹] --> B{åˆ¤æ–·æ¢ä»¶}
    B -->|æ˜¯| C[åŸ·è¡Œå‹•ä½œ]
    B -->|å¦| D[å…¶ä»–å‹•ä½œ]
    C --> E[çµæŸ]
    D --> E`,
    
            sequence: `sequenceDiagram
    participant A as ä½¿ç”¨è€…
    participant B as ç³»çµ±
    participant C as è³‡æ–™åº«
    
    A->>B: ç™¼é€è«‹æ±‚
    B->>C: æŸ¥è©¢è³‡æ–™
    C-->>B: å›å‚³çµæœ
    B-->>A: å›æ‡‰çµæœ`,
    
            gantt: `gantt
    title å°ˆæ¡ˆé€²åº¦è¡¨
    dateFormat  YYYY-MM-DD
    section è¦åŠƒéšæ®µ
    éœ€æ±‚åˆ†æ     :done, des1, 2024-01-01, 2024-01-10
    ç³»çµ±è¨­è¨ˆ     :active, des2, 2024-01-11, 2024-01-20
    section é–‹ç™¼éšæ®µ
    å‰ç«¯é–‹ç™¼     :des3, after des2, 20d
    å¾Œç«¯é–‹ç™¼     :des4, after des2, 25d`,
    
            class: `classDiagram
    class Animal {
        +String name
        +int age
        +makeSound()
    }
    class Dog {
        +String breed
        +bark()
    }
    Animal <|-- Dog`,
    
            pie: `pie title å¸‚å ´ä»½é¡
    "ç”¢å“A" : 42.96
    "ç”¢å“B" : 50.05
    "ç”¢å“C" : 7.01`,
    
            git: `gitGraph
    commit
    branch develop
    checkout develop
    commit
    commit
    checkout main
    merge develop
    commit`
        };
        
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            const btn = document.querySelector('.theme-toggle');
            btn.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
            
            currentTheme = isDark ? 'dark' : 'light';
            document.getElementById('theme-select').value = currentTheme;
        }
        
        function setTheme(theme) {
            currentTheme = theme;
            const isDark = theme === 'dark';
            
            if (isDark && !document.body.classList.contains('dark-mode')) {
                document.body.classList.add('dark-mode');
                document.querySelector('.theme-toggle').textContent = 'â˜€ï¸';
            } else if (!isDark && document.body.classList.contains('dark-mode')) {
                document.body.classList.remove('dark-mode');
                document.querySelector('.theme-toggle').textContent = 'ğŸŒ™';
            }
        }
        
        function loadExample(type) {
            document.getElementById('code-input').value = examples[type];
            showStatus('ç¯„ä¾‹è¼‰å…¥å®Œæˆ');
        }
        
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.className = `status ${type}`;
            status.innerHTML = message;
            
            if (type !== 'error') {
                setTimeout(() => {
                    status.innerHTML = '';
                    status.className = 'status';
                }, 3000);
            }
        }
        
        async function renderDiagram() {
            const code = document.getElementById('code-input').value.trim();
            const format = document.getElementById('format-select').value;
            const quality = document.getElementById('quality-select').value || 'web';
            
            if (!code) {
                showStatus('è«‹è¼¸å…¥ Mermaid ä»£ç¢¼', 'error');
                return;
            }
            
            showStatus('<div class="loading"></div> æ­£åœ¨æ¸²æŸ“ä¸­...', 'info');
            
            try {
                const response = await fetch('/render', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        code,
                        format,
                        theme: currentTheme,
                        quality
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'æ¸²æŸ“å¤±æ•—');
                }
                
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                
                const previewArea = document.getElementById('preview-area');
                const zoomControls = document.querySelector('.zoom-controls');
                
                if (format === 'svg') {
                    // SVG é è¦½
                    const img = document.createElement('img');
                    img.src = url;
                    img.onload = () => {
                        previewArea.innerHTML = '';
                        previewArea.appendChild(img);
                        previewArea.appendChild(zoomControls);
                        setupSVGInteraction(img);
                        zoomControls.style.display = 'flex';
                        resetZoom();
                    };
                } else {
                    // PNG é¡¯ç¤º
                    const img = document.createElement('img');
                    img.src = url;
                    img.style.maxWidth = '100%';
                    img.style.maxHeight = '100%';
                    previewArea.innerHTML = '';
                    previewArea.appendChild(img);
                    previewArea.appendChild(zoomControls);
                    zoomControls.style.display = 'none';
                }
                
                // å„²å­˜æœ€å¾Œçš„æ¸²æŸ“æ•¸æ“š
                lastRenderData = { blob, filename: `mermaid_${Date.now()}.${format}` };
                
                showStatus(`âœ… ${format.toUpperCase()} æ¸²æŸ“å®Œæˆ`, 'success');
                
            } catch (error) {
                console.error('æ¸²æŸ“éŒ¯èª¤:', error);
                showStatus(`âŒ ${error.message}`, 'error');
            }
        }
        
        function downloadResult() {
            if (!lastRenderData) {
                showStatus('è«‹å…ˆæ¸²æŸ“åœ–è¡¨', 'error');
                return;
            }
            
            const url = URL.createObjectURL(lastRenderData.blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = lastRenderData.filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('âœ… ä¸‹è¼‰é–‹å§‹', 'success');
        }
        
        async function loadHistory() {
            showStatus('<div class="loading"></div> è¼‰å…¥æ­·å²è¨˜éŒ„...', 'info');
            
            try {
                const response = await fetch('/history');
                
                if (!response.ok) {
                    throw new Error('è¼‰å…¥æ­·å²è¨˜éŒ„å¤±æ•—');
                }
                
                const data = await response.json();
                displayHistory(data.history);
                showStatus(`âœ… è¼‰å…¥äº† ${data.history.length} ç­†æ­·å²è¨˜éŒ„`, 'success');
                
            } catch (error) {
                console.error('è¼‰å…¥æ­·å²è¨˜éŒ„éŒ¯èª¤:', error);
                showStatus(`âŒ ${error.message}`, 'error');
            }
        }
        
        function extractDiagramInfo(code) {
            const lines = code.split('\n').filter(line => line.trim());
            let title = '';
            let preview = '';
            
            // å˜—è©¦æå– title
            for (const line of lines) {
                const titleMatch = line.match(/title\s+(.*)/i);
                if (titleMatch) {
                    title = titleMatch[1].trim();
                    break;
                }
            }
            
            // å¦‚æœæ²’æœ‰æ¨™é¡Œï¼Œå˜—è©¦æå–åœ–è¡¨é¡å‹
            if (!title) {
                const firstLine = lines[0].trim();
                if (firstLine.startsWith('graph')) title = 'æµç¨‹åœ–';
                else if (firstLine.startsWith('sequenceDiagram')) title = 'åºåˆ—åœ–';
                else if (firstLine.startsWith('gantt')) title = 'ç”˜ç‰¹åœ–';
                else if (firstLine.startsWith('classDiagram')) title = 'é¡åˆ¥åœ–';
                else if (firstLine.startsWith('pie')) title = 'åœ“é¤…åœ–';
                else if (firstLine.startsWith('gitGraph')) title = 'Git åœ–';
                else title = 'æœªçŸ¥åœ–è¡¨';
            }
            
            // ç”Ÿæˆé è¦½ï¼ˆå‰3è¡Œï¼‰
            preview = lines.slice(0, 3).join('\n');
            if (lines.length > 3) preview += '\n...';
            
            return { title, preview };
        }
        
        function displayHistory(history) {
            const historySection = document.getElementById('history-section');
            const historyList = document.getElementById('history-list');
            const historyPagination = document.getElementById('history-pagination');
            
            if (history.length === 0) {
                historyList.innerHTML = '<p style="color: var(--text-color); opacity: 0.7;">ä»Šæ—¥æš«ç„¡æ­·å²è¨˜éŒ„</p>';
                historyPagination.innerHTML = '';
            } else {
                // è¨ˆç®—åˆ†é 
                const totalPages = Math.ceil(history.length / itemsPerPage);
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                const currentItems = history.slice(startIndex, endIndex);
                
                // é¡¯ç¤ºç•¶å‰é é¢çš„é …ç›®
                historyList.innerHTML = currentItems.map(item => {
                    const date = new Date(item.timestamp);
                    const dateTimeStr = date.toLocaleString('zh-TW', { 
                        month: '2-digit', 
                        day: '2-digit', 
                        hour: '2-digit', 
                        minute: '2-digit',
                        hour12: false 
                    });
                    
                    const { title, preview } = extractDiagramInfo(item.code);
                    
                    return `
                        <div class="history-item" onclick="loadHistoryItem('${item.id}')">
                            <div class="history-meta">
                                <span class="history-time">${dateTimeStr}</span>
                                <span class="history-theme">${item.theme === 'dark' ? 'æ·±è‰²' : 'æ·ºè‰²'}</span>
                            </div>
                            <div class="history-code">
                                <div class="history-code-title">${title}</div>
                                <div>${preview}</div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // é¡¯ç¤ºåˆ†é æ§åˆ¶
                if (totalPages > 1) {
                    let paginationHTML = '';
                    
                    // ä¸Šä¸€é 
                    if (currentPage > 1) {
                        paginationHTML += `<button class="page-btn" onclick="changePage(${currentPage - 1})">â€¹ ä¸Šä¸€é </button>`;
                    }
                    
                    // é ç¢¼
                    for (let i = 1; i <= totalPages; i++) {
                        if (i === currentPage) {
                            paginationHTML += `<button class="page-btn active">${i}</button>`;
                        } else {
                            paginationHTML += `<button class="page-btn" onclick="changePage(${i})">${i}</button>`;
                        }
                    }
                    
                    // ä¸‹ä¸€é 
                    if (currentPage < totalPages) {
                        paginationHTML += `<button class="page-btn" onclick="changePage(${currentPage + 1})">ä¸‹ä¸€é  â€º</button>`;
                    }
                    
                    historyPagination.innerHTML = paginationHTML;
                } else {
                    historyPagination.innerHTML = '';
                }
            }
            
            historySection.style.display = 'block';
            historySection.scrollIntoView({ behavior: 'smooth' });
            
            // å„²å­˜æ­·å²æ•¸æ“šä¾›å¾ŒçºŒä½¿ç”¨
            window.historyData = history;
        }
        
        function changePage(page) {
            currentPage = page;
            displayHistory(window.historyData);
        }
        
        function setupSVGInteraction(svgElement) {
            svgElement.classList.add('preview-svg');
            
            // æ»¾è¼ªç¸®æ”¾
            svgElement.addEventListener('wheel', function(e) {
                e.preventDefault();
                const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
                zoomSVG(zoomFactor);
            });
            
            // æ‹–æ‹½åŠŸèƒ½
            svgElement.addEventListener('mousedown', function(e) {
                isDragging = true;
                dragStart.x = e.clientX - svgPosition.x;
                dragStart.y = e.clientY - svgPosition.y;
                svgElement.style.cursor = 'grabbing';
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isDragging) return;
                
                svgPosition.x = e.clientX - dragStart.x;
                svgPosition.y = e.clientY - dragStart.y;
                
                updateSVGTransform();
            });
            
            document.addEventListener('mouseup', function() {
                isDragging = false;
                const svgElement = document.querySelector('.preview-svg');
                if (svgElement) {
                    svgElement.style.cursor = 'grab';
                }
            });
        }
        
        function zoomSVG(factor) {
            currentZoom *= factor;
            currentZoom = Math.max(0.1, Math.min(5, currentZoom));
            updateSVGTransform();
        }
        
        function resetZoom() {
            currentZoom = 1;
            svgPosition = { x: 0, y: 0 };
            updateSVGTransform();
        }
        
        function updateSVGTransform() {
            const svgElement = document.querySelector('.preview-svg');
            if (svgElement) {
                svgElement.style.transform = `translate(${svgPosition.x}px, ${svgPosition.y}px) scale(${currentZoom})`;
                
                // æ›´æ–°ç¸®æ”¾æŒ‰éˆ•é¡¯ç¤º
                const zoomDisplay = document.querySelector('.zoom-btn:nth-child(2)');
                if (zoomDisplay) {
                    zoomDisplay.textContent = Math.round(currentZoom * 100) + '%';
                }
            }
        }
        
        function loadHistoryItem(id) {
            if (!window.historyData) return;
            
            const item = window.historyData.find(h => h.id === id);
            if (item) {
                document.getElementById('code-input').value = item.code;
                setTheme(item.theme);
                showStatus(`å·²è¼‰å…¥æ­·å²è¨˜éŒ„ (${new Date(item.timestamp).toLocaleTimeString('zh-TW')})`);
                
                // æ»¾å‹•åˆ°ç·¨è¼¯å€
                document.querySelector('.main-content').scrollIntoView({ behavior: 'smooth' });
                
                // è‡ªå‹•æ¸²æŸ“
                renderDiagram();
            }
        }
        
        // ç›£è½æ ¼å¼è®Šæ›´ï¼Œé¡¯ç¤º/éš±è—å“è³ªé¸é …
        document.getElementById('format-select').addEventListener('change', function() {
            const qualitySelect = document.getElementById('quality-select');
            if (this.value === 'png') {
                qualitySelect.style.display = 'inline-block';
            } else {
                qualitySelect.style.display = 'none';
            }
        });
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œé è¨­è¼‰å…¥ç¯„ä¾‹
        window.addEventListener('load', function() {
            loadExample('flowchart');
        });
    </script>
</body>
</html>